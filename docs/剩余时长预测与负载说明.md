# 剩余时长预测与“外电路功耗”的关系

## 你的疑问

> 模型不知道数据集里电池的外电路功耗（CPU、屏幕等），那怎么预测剩余时长？

核心点：**预测剩余时长，靠的是“未来的电流（或功率）”，不是模型去猜外电路功耗**。而且**当前用的数据集本身就没有“手机外电路”**。

---

## 一、当前验证用的是什么数据？

- **NASA PCoE 数据集**（如 B0005、B0006）是**实验室恒流放电**：
  - 负载是**电阻/电子负载**，电流由实验协议给定（例如恒流 2 A 放电到 2.7 V）。
  - **没有** CPU、屏幕、后台应用等“手机外电路”。
  - 所以热模型里设 **P_device = 0** 是对的：没有设备往电芯里灌热。

在这种设定下：

- **“剩余时长”** 的定义是：在**同一恒流 I**（例如 2 A）下，从当前时刻算起，多久电压会到截止电压（如 2.7 V）。
- 预测时**不需要知道“外电路功耗”**，因为负载就是**已知的恒流 I**，模型只需要用这个 I 做时间步进即可。

也就是说：**在 NASA 这种协议下，负载（电流）是已知的，不存在“不知道外电路功耗”的问题。**

---

## 二、要是真用在“手机”上，剩余时长怎么预测？

这时确实会有“外电路”的功耗（CPU、屏幕、网络等），但可以这样理清：

### 1. 电学侧：决定电压和 SOC 的是**电流 I(t)**，不是 P_device

- 端电压方程：\(V = U_{\mathrm{ocv}} - I\,R_0 - \eta_1 - \eta_2\)。
- SOC 变化：\(\mathrm{d}z/\mathrm{d}t \propto -I\)。
- 所以**只要知道未来电流 I(t)**（或能估计出来），就能积分得到电压和 SOC，从而得到**到达截止电压的时间**，即剩余时长。

因此：

- **若系统能提供“未来电流”**（例如 BMS 或 OS 给出预估的 I(t)），则直接用这个 I(t) 做仿真即可预测剩余时长，**不需要单独知道“外电路功耗”是多少瓦**。
- **若系统只提供“未来功率”P(t)**（例如 CPU+屏幕+… 的总功率）：
  - 电学上可写 \(I(t) = P(t)/V(t)\)，和电压方程联立，一起积分，同样能得到 V(t)、z(t)，从而得到剩余时长。
  - 这里**P(t) 就是“外电路功耗”**，但它是**作为输入**由系统/用户/场景给定的，不是模型凭空猜的。

所以：**剩余时长预测 = 在“给定的未来负载 I(t) 或 P(t)”下，用模型积分算到 V 达到截止电压的时间。**  
“外电路功耗”如果出现，是以**负载输入**的身份出现（P(t) 或换算成 I(t)），而不是模型自己猜出来的。

### 2. 热学侧：P_device 只影响温度，对“剩余时长”通常是次要的

- 热模型里：\(Q_{\mathrm{gen}} = I^2 R_{\mathrm{total}} + P_{\mathrm{device}}\)，\(P_{\mathrm{device}}\) 是**设备发热灌进电芯**的功率（W）。
- 若**不知道**设备发热，通常设 **P_device = 0**，只保留 \(I^2 R\) 的发热。
- 这样会低估一点温升，进而 R(T) 略偏大、压降略大，剩余时长会略偏保守（略短），一般误差不大。
- 也就是说：**不知道外电路功耗（这里指 P_device）时，仍然可以预测剩余时长**，只是温度与内阻的精度会差一点，通常不影响“能不能预测”的结论。

---

## 三、小结（直接回答你的问题）

| 问题 | 回答 |
|------|------|
| 不知道数据集里电池的“外电路功耗”，怎么预测剩余时长？ | **当前 NASA 数据根本没有外电路**，负载就是**恒流 I**，已知；预测时用这个 I 积分即可，不需要 P_device。 |
| 若以后用在手机上，不知道 CPU/屏幕功耗怎么办？ | 预测剩余时长需要**未来的负载**：要么给定 **I(t)**，要么给定 **P(t)** 再用 \(I=P/V\) 与电压联立。P(t) 由系统/场景/用户设定或估计，不是模型猜的；若完全不知道，可假设“与最近一段时间相同”或“典型场景”。 |
| P_device 不知道怎么办？ | 热学里可设 **P_device = 0**；主要影响温度，对剩余时长通常是次要的，预测仍可做，只是温度/内阻略不准。 |

**一句话**：**剩余时长 = 在“给定或假设的负载 I(t)（或 P(t)）”下，用模型积分到截止电压的时间。** 模型负责把负载转换成电压/SOC/温度；**负载本身要由数据、系统或场景给出，而不是由模型猜外电路功耗。**
